docs:

- home page is cached based on {key, localization and branch_id}. The cache will be cleared when advertisement / product / branches product is created or updated or deleted
- role with {can-receive-order-notifications} permission will receive the order notification by default
- there is two global scopes for the api content {branch scope and published_at scope}
- DB builder is used in {home service + cache service + session service + filament widgets + transactions + insert order archive}
- optional authentication is used in {set the default branch + favorite product}
- default branch is set in {SetCurrentBranch middleware} and effect {BranchScope + AppServiceProvider -> configureBuilder}
- advertisements / coupons / branches products / payment are scoped based on the branch id
- audit is only applied for order and tickets
- advertisement model has a getter propriety called link: which means the advertisement can be connected to {product and category, category, external link}
- categories are build like a tree and they follow these rules:
    - a category can not edit it's parent id
    - category hierarchy depth cannot exceed 3 levels.
    - a product can not connect to root categories
- city model has a boundary field, it saves five points each point has three keys: {name, latitude, longitude} these point represent a rectangular shape. they are saved as json string. The points are:
    - bl: bottom left
    - br: bottom right
    - tr: top right
    - tr: top right
    - c: center
- coupon model has one type which is TIMED other types can be added and configured in the CouponType enum
- multi payment methods gateways can be added and configured using a class that follows this declaration {class ThePaymentGateway extends BasePaymentGateway implements PaymentGatewayInterface}
- translation fields are handled by laravel spatie translation spatie/laravel-translatable
    - there is a custom component called TranslationComponent that handles translation 
    - there is a custom helper function get_translatable_attribute() which is used when the db builder is used instead of eloquent
- third party services:
    - twilio/sdk: handle OTP
    - stevebauman/location: handle IP info
    - kreait/laravel-firebase: handle firebase notifications
    - MoyasarPaymentGateway: handle payment methods
- a SetupException will be fired if:
    - there is no customer role
    - there is no default branch
    - there is no user who has {can-receive-order-notifications} permission
    - one of the required settings keys are missing
- publish logic
    - payment methods can be created and published per branch | unpublished is denied for pay-on-delivery payment method
    - coupons can be created and published per branch | unpublished is ok
    - gifts can be created and published per branch | unpublished is ok
    - advertisement can be created and published per branch | unpublished is ok
    - for advertisement which are connected to unpublished models, will not be appear in the api
    - categories can be created and published per branch | unpublished will not be cascaded to products and chid categories
    - branches products can be published | unpublished is ok
    - branches can be published only if:
        1- at least one delivery user attached
        2- at least one user to receive notification order
        3- pay-on-delivery payment method is published
        4- unpublished will not be cascaded to products
    - effected api:
        - GetPaymentMethods
        - GetCategories
        - GetBranches
        - GetHome
        - GetFavoriteProducts
        - GetOrderDetails
        - GetPackageProducts
        - GetProductDetails
        - GetProducts
- notification
    - notification send to users
        - when order status change the system send in-app (mobile) / firebase (mobile) notification
        - when a reply is created for a ticket the system send in-app / firebase notification
    - notification send to delivery
        - when an order status is attached to delivery the system send in-app (dashboard) notification
    - notification send to manager / users who has the {can-receive-order-notifications} permission
        - when an order is created the system send in-app (dashboard) notification
        - when an order is cancelled the system send in-app (dashboard) notification
- policy
    - dashboard policy is handled by policies classes
    - role permissions are handled by trait called CanManagePermissions
    - some permissions have dependence's and they are defined in this class PermissionDependencyService
- settings 
    - SettingsService is responsible to define the getter of each setting, the form component of each setting, the cast of each setting and to cache them all
- resource lock is using HasConcurrentEditingProtection trait and a custom lock logic is added to
    - BaseFilesRelationManager
    - UsersRelationManager
- loyalties:
    - the LoyaltyService is responsible for handling loyalty points and gifts
    - loyalty points are added to the user only if the order is closed and it does not have a discount
    - customer can not redeem the gift twice
    - gifts has the following attributes:
        - points: points count which are required to redeem the gift
        - code: the gift code which the customer can use to apply the gift
        - discount: the amount of discount
        - allowed_sub_total_price: the minimum subtotal price allowed to apply the gift
    - Loyalty has the following attributes:
        - user_id: the customer id
        - points: the customer current total points
        - total_earned: the customer total points earned
        - total_redeemed: the customer current total points redeemed
- user delete:
    - if a user is blocked, it can not be deleted
    - if a user has an order which is not finished or cancelled, it can not be deleted
- timezone:
    - inApplicationTimezone() helper function is used to convert a date to the application timezone
    - inApplicationTodayRange() helper function is used to get the start and end of today in the application timezone.
- fcm bulk notification:
    - FirebaseFCMLinks enum is used to define which model can be deep linked to a bulk notification
    - FirebaseFCMTopics enum is used to define topics and resolve the options available for bulk actions
- audit is applied on:
    - branch products
    - carts products
    - coupons
    - orders
    - roles
    - role permissions
    - settings
    - users
- branch filter system:
    - branch filter system will only be checking data if the user has the {filter-branch-content} permission
    - the create process is handled by filtering the select branch
    - the view process is handled by the branch scope
    - the update/delete/custom action is handled by policies
    - users and bulk user notifications is not filtered by this system
- order lifecycle:
    - the order is managed by two classes:
        - OrderService: handles the orders actions
        - OrderProcess: handle the orders creation
    - notification are sent according to the notification docs
    - makeOrderProcess has a BranchSettingsService which is layer to future proof getting setting per branch
    - OrderProcess->calculateCartWeight() is commented and can be used to "calculate cart weight"
    - OrderProcess->createOrderBill() is used to create a temporary bill for the order
    - OrderProcess->createOrder() is used to create the order
    - order is created via order process class and it's status is set to pending
    - order can be approved or force approved by a manager
        - force approve means that the manager is approving an order which is not created today, it's not checked out or the system is offline
        - approving an order means the manager is now responsible to handle the order
    - after approving, the order is processing and can be edited if needed
    - order can be assigned to a delivery
    - order can marked as finished by the manager or the delivery person
    - order can closed by a manager
        - closing an order means that:
            - the order is marked as closed and can be archived
            - the payed price is entered and saved. If it's not pay on delivery the payed price is saved automatically
            - product quantity is decremented
            - loyalty points are added to the customer if there is no discount
    - order can be archived which means the order is moved to the archive table and is hidden from the user
    - order can be cancelled by the manager or the customer and if the order status is pending or processing